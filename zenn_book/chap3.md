# プログラムインターフェース

re2c が生成するレキサーとのインターフェースについて記載します。

https://re2c.org/manual/manual_c.html#program-interface

re2c が生成するレキサーを利用するためのインターフェースは２種類あります。


1. ポインタAPI
- C言語のデフォルト
- re2cはもともとC言語向けのツールなので、歴史的な経緯含め「デフォルトAPI」扱い
- ポインタ演算が前提のAPI

2. 汎用API
- 非ポインタ演算API
- Goバックエンドでのデフォルト
- C言語で利用する場合 `--input custom` もしくは `re2c:flags:input = custom;` オプションが必要

個人的には、C言語でレキサーを生成する場合はポインタAPIを使うことになるのではという印象です。
よって本書ではポインタAPIをメインに解説していきます。


## API

re2c の各APIには `YY` という接頭辞を持ちます。
レキサーを自分が望む動作にカスタマイズするために、これらの変数・関数を操作することになります。

特に利用することが多くなる代表的なAPIは以下の通りです。

|変数名|役割|
|-----|----|
|YYCTYPE|レキサーが解析する文字列の型|
|YYCURSOR|スキャナが見ている文字を指すポインタ|
|YYMARKER|バックトラック情報|
|YYLUMIT|バッファの上限アドレスを指すポインタ|
|YYFILL|バッファへ文字列を再充填する関数|


## ディレクティブ

ソースコード中にディレクティブを記述することで、状況に合わせたソースコードに置換されます。
`/*!re2c ... */` も一つのディレクティブです。


## 設定

ディレクティブに設定を記述することで動作をカスタマイズできます。

特に多く使用する設定は以下の通りです。

|設定|効果|
|---|----|
|`re2c:define:YYCTYPE`|YYCTYPEの型を設定する|
|`re2c:define:YYCURSOR`|YYCURSORとして利用する変数名を指定する|
|`re2c:define:YYLIMIT`|YYLIMITとして利用する変数名を指定する|
|`re2c:define:YYFILL`|YYFILLとして利用する関数名や関数定義を指定する|


## API の記述方法

APIの記述方法には２種類あります。

1. C言語のプリプロセッサとして記述する方法
re2c が生成したソースコードに記載されたAPI名をプリプロセッサでそのまま置換する素直な方法

```c
#define  YYPEEK()  *YYCURSOR
```

2. ディレクティブ中の設定でフリーフォーマットで書く方法
ディレクティブ中に `re2c:api:style = free-form;` の設定を記述することで有効になる。
プリプロセッサではなく、re2c が設定された文字列で直接ソースコードを生成する。

```txt
re2c:define:YYSKIP       = "++YYCURSOR";
```

## まとめ
かるくAPIを紹介しましたが、具体的な使い方は次章以降で説明します。
とりあえず re2c でどのようにAPIを記載していくか、ということをざっくり把握してもらえれば大丈夫です。